var app=angular.module("prodFilterApp",["angularUtils.directives.dirPagination"]);app.controller("prodFilterCntl",["$scope","$location","$http","$timeout",function(e,t,r,a){e.updateCheckboxItems=function(t,r,a,o){if("undefined"!=typeof a&&-1!=a&&""!=a){for(tempURLArray=a.split(","),retArrayIDs=tempURLArray,retStringIDs=e.arrayToString2(tempURLArray),retArrayText=[],i=0;i<tempURLArray.length;i++)tempModelID=$("#filter"+t+" input[data-id='"+tempURLArray[i]+"']").attr("ng-model"),tempModelID=tempModelID.replace(r,""),tempModelID=tempModelID.replace("[",""),tempModelID=tempModelID.replace("]",""),o[tempModelID]=!0,$("#mFilter"+t+" input[data-id='"+tempURLArray[i]+"']").prop("checked",!0),tempTextValue=$("#filterRegion input[data-id='"+tempURLArray[i]+"']").parent().find(".txt").html(),retArrayText.push(tempTextValue);var n=e.arrayToString(retArrayText);return[retArrayIDs,retStringIDs,retArrayText,n]}},e.$on("$locationChangeSuccess",function(r,o,n){var i=t.path(),p=i.split("/");if(""==i)t.path("/regions/-1/documents/-1/SBU/-1/solutions/-1/sort/Newest/page/1/search/");else{var u=p[2];e.region=[];var l=e.region;$("#mFilterRegion input").prop("checked",!1);var c=e.updateCheckboxItems("Region","region",u,l);"undefined"!=typeof c&&(e.regionArrayID=c[0],e.regionStringID=c[1],e.regionArrayText=c[2],e.regionSelected=c[3]);var s=p[4];e.docType=[];var g=e.docType;$("#mFilterDocType input").prop("checked",!1);var c=e.updateCheckboxItems("DocumentType","docType",s,g);"undefined"!=typeof c&&(e.docTypeArrayID=c[0],e.docTypeStringID=c[1],e.docTypeArrayText=c[2],e.docTypeSelected=c[3]);var d=p[8];e.solution=[];var y=e.solution;$("#mFilterSolution input").prop("checked",!1);var c=e.updateCheckboxItems("Solution","solution",d,y);"undefined"!=typeof c&&(e.solutionArrayID=c[0],e.solutionStringID=c[1],e.solutionArrayText=c[2],e.solutionSelected=c[3]);var m=p[10];"undefined"==typeof m&&(m="Newest"),e.sortItems=m,$("#filterSort .customSelectC ul").find("li[value='"+m+"']").prop("selected",!0),e.mytimeout=a(function(){$("#filterSort .customSelectC .currentItem").text(m)},800);var A=p[12];"undefined"==typeof A&&(A="1"),e.pageNumber=A;var S=p[14];"undefined"==typeof S&&(S=""),e.searchFilter=S,e.runQuery()}}),e.updateArray=function(e,t,r,a){if(r)e.push(t);else{var o=e.indexOf(t);e.splice(o,1)}return e},e.arrayToString=function(e){return tempString="",tempString=e.join(", "),""==tempString&&(tempString="All"),tempString},e.arrayToString2=function(e){return tempString="",tempString=e.join(","),""==tempString&&(tempString="-1"),tempString},e.searchFilter="",e.search=function(t){e.pathUpdate()},e.regionArrayID=[],e.regionStringID="-1",e.regionArrayText=[],e.regionSelected="All",e.regionWatch=function(t,r,a){e.regionArrayID=e.updateArray(e.regionArrayID,t,a),e.regionStringID=e.arrayToString2(e.regionArrayID),e.regionArrayText=e.updateArray(e.regionArrayText,r,a),e.regionSelected=e.arrayToString(e.regionArrayText),e.pathUpdateDebounce()},e.docTypeArrayID=[],e.docTypeStringID="-1",e.docTypeArrayText=[],e.docTypeSelected="All",e.docTypeWatch=function(t,r,a){e.docTypeArrayID=e.updateArray(e.docTypeArrayID,t,a),e.docTypeStringID=e.arrayToString2(e.docTypeArrayID),e.docTypeArrayText=e.updateArray(e.docTypeArrayText,r,a),e.docTypeSelected=e.arrayToString(e.docTypeArrayText),e.pathUpdateDebounce()},e.solutionArrayID=[],e.solutionStringID="-1",e.solutionArrayText=[],e.solutionSelected="All",e.solutionWatch=function(t,r,a){e.solutionArrayID=e.updateArray(e.solutionArrayID,t,a),e.solutionStringID=e.arrayToString2(e.solutionArrayID),e.solutionArrayText=e.updateArray(e.solutionArrayText,r,a),e.solutionSelected=e.arrayToString(e.solutionArrayText),e.pathUpdateDebounce()},e.sortItems="Newest",e.sorting=function(){e.pathUpdate()},$("#filterSort .customSelectC").on("click","li",function(t){var r=$(this).text();e.sortItems=r,e.$apply(e.pathUpdate())}),e.reset=function(){e.searchFilter="",e.regionArrayID=[],e.regionStringID="-1",e.regionArrayText=[],e.regionSelected="All",e.docTypeArrayID=[],e.docTypeStringID="-1",e.docTypeArrayText=[],e.docTypeSelected="All",e.solutionArrayID=[],e.solutionStringID="-1",e.solutionArrayText=[],e.solutionSelected="All",e.sortItems="Newest",e.pageNumber=1,e.pathUpdate()},e.total_count,e.itemsPerpage,e.pageNumber=1,e.pageChanged=function(t){e.pageNumber=t,e.pathUpdateDebounce()},e.pathUpdate=function(){e.pageURL="/",e.pageURL=e.pageURL+"regions/"+e.regionStringID,e.pageURL=e.pageURL+"/documents/"+e.docTypeStringID,e.pageURL=e.pageURL+"/SBU/-1",e.pageURL=e.pageURL+"/solutions/"+e.solutionStringID,e.pageURL=e.pageURL+"/sort/"+e.sortItems,e.pageURL=e.pageURL+"/page/"+e.pageNumber,e.pageURL=e.pageURL+"/search/"+e.searchFilter,t.path(e.pageURL)},e.pathUpdateDebounce=function(){a.cancel(e.mytimeout),e.mytimeout=a(function(){e.pathUpdate()},800)},e.runQuery=function(){e.ajaxRequest="http://localhost:51872/filter/",e.ajaxRequest=e.ajaxRequest+"regions/"+e.regionStringID,e.ajaxRequest=e.ajaxRequest+"/documents/"+e.docTypeStringID,e.ajaxRequest=e.ajaxRequest+"/SBU/-1",e.ajaxRequest=e.ajaxRequest+"/solutions/"+e.solutionStringID,e.ajaxRequest=e.ajaxRequest+"/sort/"+e.sortItems,e.ajaxRequest=e.ajaxRequest+"/page/"+e.pageNumber,e.ajaxRequest=e.ajaxRequest+"/search/"+e.searchFilter,e.dataLoaded=function(){return!1},e.prodfilterResults="",r.get(e.ajaxRequest).then(function(t){e.prodfilterResults=t.data.results,e.total_count=t.data.pagecount,e.itemsPerpage=t.data.itemsPerpage,e.dataLoaded=function(){return!0},e.checkForResults=function(){return null===e.prodfilterResults?!0:!1}})},e.URL_RegionNumArrayStore=[],$("#mobileFilterNav").on("click","input[type='checkbox']",function(){var r=t.path(),o=r.split("/");URL_RegionNum=o[2],e.URL_RegionNumArray=URL_RegionNum.split(",");var n=$(this).attr("data-id"),i=$(this).is(":checked"),p=$(this).attr("ng-model"),u=p.split("["),l=u[0].replace("[","");switch(l){case"region":if(console.log("X"),i)"-1"==e.URL_RegionNumArray[0]&&e.URL_RegionNumArrayStore.splice("-1",1),e.URL_RegionNumArrayStore.push(n),URL_RegionNum=e.arrayToString2(e.URL_RegionNumArrayStore);else{var c=e.URL_RegionNumArrayStore.indexOf(n);e.URL_RegionNumArrayStore.splice(c,1),URL_RegionNum=e.arrayToString2(e.URL_RegionNumArrayStore)}}a.cancel(e.mytimeout2),e.mytimeout2=a(function(){},800)})}]);