var app=angular.module("prodFilterApp",["angularUtils.directives.dirPagination"]);app.controller("prodFilterCntl",["$scope","$location","$http","$timeout",function(e,t,r,o){e.updateCheckboxItems=function(t,r,o,a){if("undefined"!=typeof o&&-1!=o&&""!=o){for(tempURLArray=o.split(","),retArrayIDs=tempURLArray,retStringIDs=e.arrayToString2(tempURLArray),retArrayText=[],i=0;i<tempURLArray.length;i++)tempModelID=$("#filter"+t+" input[data-id='"+tempURLArray[i]+"']").attr("ng-model"),tempModelID=tempModelID.replace(r,""),tempModelID=tempModelID.replace("[",""),tempModelID=tempModelID.replace("]",""),a[tempModelID]=!0,$("#mFilter"+t+" input[data-id='"+tempURLArray[i]+"']").prop("checked",!0),tempTextValue=$("#filter"+t+" input[data-id='"+tempURLArray[i]+"']").parent().find(".txt").html(),retArrayText.push(tempTextValue);var n=e.arrayToString(retArrayText);return[retArrayIDs,retStringIDs,retArrayText,n]}},e.$on("$locationChangeSuccess",function(r,a,n){var i=t.path(),p=i.split("/");if(""==i)t.path("/regions/-1/documents/-1/SBU/-1/solutions/-1/sort/Newest/page/1/search/");else{var u=p[2];e.region=[];var c=e.region;$("#mFilterRegion input").prop("checked",!1);var l=e.updateCheckboxItems("Region","region",u,c);"undefined"!=typeof l?(e.regionArrayID=l[0],e.regionStringID=l[1],e.regionArrayText=l[2],e.regionSelected=l[3]):(e.regionArrayID=[],e.regionStringID="-1",e.regionArrayText=[],e.regionSelected="All");var s=p[4];e.docType=[];var y=e.docType;$("#mFilterDocumentType input").prop("checked",!1);var l=e.updateCheckboxItems("DocumentType","docType",s,y);"undefined"!=typeof l?(e.docTypeArrayID=l[0],e.docTypeStringID=l[1],e.docTypeArrayText=l[2],e.docTypeSelected=l[3]):(e.docTypeArrayID=[],e.docTypeStringID="-1",e.docTypeArrayText=[],e.docTypeSelected="All");var d=p[8];e.solution=[];var g=e.solution;$("#mFilterSolution input").prop("checked",!1);var l=e.updateCheckboxItems("Solution","solution",d,g);"undefined"!=typeof l?(e.solutionArrayID=l[0],e.solutionStringID=l[1],e.solutionArrayText=l[2],e.solutionSelected=l[3]):(e.solutionArrayID=[],e.solutionStringID="-1",e.solutionArrayText=[],e.solutionSelected="All");var m=p[10];"undefined"==typeof m&&(m="Newest"),e.sortItems=m,$("#filterSort .customSelectC ul").find("li[value='"+m+"']").prop("selected",!0),e.mytimeout=o(function(){$("#filterSort .customSelectC .currentItem").text(m)},800);var A=p[12];"undefined"==typeof A&&(A="1"),e.pageNumber=A;var S=p[14];"undefined"==typeof S&&(S=""),e.searchFilter=S,e.runQuery()}}),e.updateArray=function(e,t,r,o){if(r)e.push(t);else{var a=e.indexOf(t);e.splice(a,1)}return e},e.arrayToString=function(e){return tempString="",tempString=e.join(", "),""==tempString&&(tempString="All"),tempString},e.arrayToString2=function(e){return tempString="",tempString=e.join(","),""==tempString&&(tempString="-1"),tempString},e.searchFilter="",e.search=function(t){e.pathUpdate()},e.regionArrayID=[],e.regionStringID="-1",e.regionArrayText=[],e.regionSelected="All",e.regionWatch=function(t,r,o){e.regionArrayID=e.updateArray(e.regionArrayID,t,o),e.regionStringID=e.arrayToString2(e.regionArrayID),e.regionArrayText=e.updateArray(e.regionArrayText,r,o),e.regionSelected=e.arrayToString(e.regionArrayText),e.pathUpdateDebounce()},e.docTypeArrayID=[],e.docTypeStringID="-1",e.docTypeArrayText=[],e.docTypeSelected="All",e.docTypeWatch=function(t,r,o){e.docTypeArrayID=e.updateArray(e.docTypeArrayID,t,o),e.docTypeStringID=e.arrayToString2(e.docTypeArrayID),e.docTypeArrayText=e.updateArray(e.docTypeArrayText,r,o),e.docTypeSelected=e.arrayToString(e.docTypeArrayText),e.pathUpdateDebounce()},e.solutionArrayID=[],e.solutionStringID="-1",e.solutionArrayText=[],e.solutionSelected="All",e.solutionWatch=function(t,r,o){e.solutionArrayID=e.updateArray(e.solutionArrayID,t,o),e.solutionStringID=e.arrayToString2(e.solutionArrayID),e.solutionArrayText=e.updateArray(e.solutionArrayText,r,o),e.solutionSelected=e.arrayToString(e.solutionArrayText),e.pathUpdateDebounce()},e.sortItems="Newest",e.sorting=function(){e.pathUpdate()},$("#filterSort .customSelectC").on("click","li",function(t){var r=$(this).text();e.sortItems=r,e.$apply(e.pathUpdate())}),e.reset=function(){e.searchFilter="",e.regionArrayID=[],e.regionStringID="-1",e.regionArrayText=[],e.regionSelected="All",e.docTypeArrayID=[],e.docTypeStringID="-1",e.docTypeArrayText=[],e.docTypeSelected="All",e.solutionArrayID=[],e.solutionStringID="-1",e.solutionArrayText=[],e.solutionSelected="All",e.sortItems="Newest",e.pageNumber=1,e.pathUpdate()},e.total_count,e.itemsPerpage,e.pageNumber=1,e.pageChanged=function(t){e.pageNumber=t,e.pathUpdateDebounce()},e.pathUpdate=function(){e.pageURL="/",e.pageURL=e.pageURL+"regions/"+e.regionStringID,e.pageURL=e.pageURL+"/documents/"+e.docTypeStringID,e.pageURL=e.pageURL+"/SBU/-1",e.pageURL=e.pageURL+"/solutions/"+e.solutionStringID,e.pageURL=e.pageURL+"/sort/"+e.sortItems,e.pageURL=e.pageURL+"/page/"+e.pageNumber,e.pageURL=e.pageURL+"/search/"+e.searchFilter,t.path(e.pageURL)},e.pathUpdateDebounce=function(){o.cancel(e.mytimeout),e.mytimeout=o(function(){e.pathUpdate()},800)},e.runQuery=function(){e.ajaxRequest="http://localhost:51872/filter/",e.ajaxRequest=e.ajaxRequest+"regions/"+e.regionStringID,e.ajaxRequest=e.ajaxRequest+"/documents/"+e.docTypeStringID,e.ajaxRequest=e.ajaxRequest+"/SBU/-1",e.ajaxRequest=e.ajaxRequest+"/solutions/"+e.solutionStringID,e.ajaxRequest=e.ajaxRequest+"/sort/"+e.sortItems,e.ajaxRequest=e.ajaxRequest+"/page/"+e.pageNumber,e.ajaxRequest=e.ajaxRequest+"/search/"+e.searchFilter,e.dataLoaded=function(){return!1},e.prodfilterResults="",r.get(e.ajaxRequest).then(function(t){e.prodfilterResults=t.data.results,e.total_count=t.data.pagecount,e.itemsPerpage=t.data.itemsPerpage,e.dataLoaded=function(){return!0},e.checkForResults=function(){return null===e.prodfilterResults?!0:!1}})},$("#mobileFilterNav").on("click","input[type='checkbox']",function(){o.cancel(e.mytimeout2),e.mytimeout2=o(function(){var r=t.path(),o=r.split("/");tempRegURLArray=[],$("#mFilterRegion input:checked").each(function(){tempRegURLArray.push($(this).attr("data-id"))}),URL_RegionNum=e.arrayToString2(tempRegURLArray),tempDocTypeURLArray=[],$("#mFilterDocumentType input:checked").each(function(){tempDocTypeURLArray.push($(this).attr("data-id"))}),URL_DocTypeNum=e.arrayToString2(tempDocTypeURLArray),tempSolutionURLArray=[],$("#mFilterSolution input:checked").each(function(){tempSolutionURLArray.push($(this).attr("data-id"))}),URL_SolutionNum=e.arrayToString2(tempSolutionURLArray),e.$apply(t.path("/regions/"+URL_RegionNum+"/documents/"+URL_DocTypeNum+"/SBU/"+o[6]+"/solutions/"+URL_SolutionNum+"/sort/"+o[10]+"/page/"+o[12]+"/search/"+o[14]))},800)})}]);